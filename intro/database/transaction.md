# 트랜잭션과 데이터 무결성

## 트랜잭션이란

- 데이터베이스에서 하나의 논리적 기능을 수행하기 위한 작업의 단위
- 여러 개의 쿼리(SQL 질의문)들을 하나로 묶는 단위
- ACID(Atomicity, Consistency, Isolation, Durability)특징이 있다.

### Atomicity - 원자성

> "all or nothing"
> 
> 트랜잭션과 관련된 일이 모두 수행되었거나 되지 않았거나를 보장하는 특징

#### 예시

1. A의 잔고를 조회
2. A의 총 예치금 300만원 중 100만원을 출금
3. 출금한 금액 100만원을 B에게 입금

- 위의 1~3의 작업이 쿼리들이고 위의 작업이 하나의 트랜잭션
- 위의 작업이 성공적으로 되었을 때 A는 200만원의 예치금이, B는 100만원의 예치금을 가져야된다.
- 일부 또는 전체 작업이 실패시 일부 작업만 적용되어 결과가 나타나는 것이 아니라 모든 작업이 취소되어 A는 기존 예치금 300만원 그대로, B는 입금된 예치금이 없어야되는 결과여야된다.

#### 커밋과 롤백

**commit**

- 여러 쿼리가 성공적으로 처리되었다고 확정하는 명령어
- 트랜잭션 단위로 수행
- 변경된 내용이 모두 영구적으로 저장
- "커밋이 수행되었다." == "하나의 트랜잭션이 성공적으로 수행되었다."

**rollback**

- 트랜잭션으로 처리한 하나의 묶음 과정을 일어나기 전으로 돌리는 일(취소)


#### 데이터 무결성

> 하나의 트랜잭션의 성공과 실패를 처리하는 `commit` 과 `rollback` 덕에 데이터 무결성이 보장된다.
> 
> 또한 데이터 변경 전에 변경사항을 쉽게 확인하고 해당작업을 그룹화할 수 있다.

### Consistency - 일관성

> 허용된 방식으로만 데이터를 변경해야 함을 의미

- 데이터베이스의 모든정보는 여러 조건, 규칙에 따라 유효한 정보여야한다.
- 0원의 예치금을 가지고있는 A가 B에게 100만원을 이체할 수 없다.

### Isolation - 격리성

> 트랜잭션 수행 시 각각의 트랜잭션이 끼어들지 못하는 것

- 복수의 트랜잭션은 격리되어 병렬로 처리되어 순차적으로 처리되어지는 것처럼 보임
- 데이터베이스에는 여러사용자가 같은 데이터에 접근할 수 있어야된다.
- 격리성은 여러 격리 수준으로 나뉘어 격리성을 보장
사진(mysql 격리수준)

### Durability - 지속성

> 성공적으로 수행된 트랜잭션은 영구적으로 반영야되어야 한다.

- 장애 발생시 원래 상태로 복구하는 회복 기능이 있어야함을 의미
- 데이터베이스는 이를 위해 체크섬, 저널링, 롤백등의 기능을 제공

## 커넥션이란?

- 어플리케이션과 데이터베이스를 연결을 뜻한다.
- 어플리케이션에서 데이터베이스에 접속하고 종료하는 일련과정을 의미


## Reference

- [면접을 위한 CS 전공지식노트 / 주홍철 저](http://www.kyobobook.co.kr/product/detailViewKor.laf?ejkGb=KOR&mallGb=KOR&barcode=9791165219529)
- [데이터베이스 커넥션](https://o-jing.tistory.com/29)
- [MySQL의 격리수준](https://hleee.medium.com/%EA%B2%A9%EB%A6%AC-%EC%88%98%EC%A4%80-3287d4bcc64d)
- [팬텀 리드](https://blobeater.blog/2017/10/26/sql-server-phantom-reads/)
- [트랜잭션의 상태](https://github.com/JaeYeopHan/Interview_Question_for_Beginner/tree/master/Database#%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98%EC%9D%98-%EC%83%81%ED%83%9C)